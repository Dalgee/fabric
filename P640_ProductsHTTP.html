<!DOCTYPE html>
<html ng-app="exampleApp">
<head>
    <title>Products</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.js"></script>
    <link href="bootstrap.css" rel="stylesheet" />
    <link href="bootstrap-theme.css" rel="stylesheet" />
    <script type="text/javascript">
    	var app = angular.module('exampleApp', []);
    	app.constant('baseURL', 'http://localhost:5500/products/');
    	
    	app.controller('defaultCtrl', ['$scope','$http','baseURL',
    	                               function($scope,$http,baseURL){
    		$scope.displayMode = 'list';
    		$scope.currentProduct = null;
    		
    		$scope.listProducts = function(){
    			/* $scope.products = [
					{ id: 0, name: "Dummy1", category: "Test", price: 1.25 },
					{ id: 1, name: "Dummy2", category: "Test", price: 2.45 },
					{ id: 2, name: "Dummy3", category: "Test", price: 4.25 }            
    			] */
    			$http({
    				method: 'GET',
    				url: baseURL
    			}).success(function(data){
    				$scope.products = data;
    			}).error(function(data, status){
    				console.log('List Get=> ', status)
    			})
    		}
    		
    		$scope.deleteProduct = function(product){

    			$http({
    				method: 'delete',
    				url: baseURL + product.id,
    				data: data
    			}).success(function(data){
    				// db에서 삭제 완료되면 화면의 같은 객체도 삭제
    				console.log('Delete data=>', data);
    				$scope.products.splice($scope.products.indexOf(product), 1);
    			}).error(function(data, status){
    				console.log('List Get=> ', status)
    			})
    		}
    		
    		$scope.editOrCreateProduct = function(product){
    			if(product){
    				console.log('Edit ID=> ', product.id)
    			}
    			$scope.currentProduct = product ? angular.copy(product) : {};
    			$scope.displayMode = 'edit';
    		}
    		
    		$scope.saveEdit = function(product){
    			console.log('ID=> ', product.id)
    			if(angular.isDefined(product.id)){
    				$scope.updateProduct(product)
    			}else{
    				$scope.createProduct(product);
    			}
    		}
    		
    		$scope.updateProduct = function(product){
    			console.log('Update ID=> ', product.id)
    			$http({
    				method: 'put',
    				url: baseURL + product.id,
    				data: product
    			}).success(function(data){
    				// 성공하면 화면도 갱신
    				for(var i = 0; i < $scope.products.length; i++){
        				if($scope.products[i].id == product.id){
        					$scope.products[i] = product;
        				}
        			} 
        			$scope.displayMode = 'list';
    			}).error(function(data, status){
    				console.log('List Get=> ', status)
    			})
    			
    			
    		}
    		
    		$scope.createProduct = function(product){
    			$http({
    				method: 'post',
    				url: baseURL,
    				data: product
    			}).success(function(data){
    				// id는 자동으로 생성해 준다
    				$scope.products.push(product);
        			$scope.displayMode = 'list';
        			
        			// 새로 갱신된 자료를 화면에 표시
        			$scope.listProducts();
    			}).error(function(data, status){
    				console.log('List Get=> ', status)
    			})
    			
    		}
    		
    		$scope.cancelEdit = function(){
    			$scope.currentProduct = {};
    			$scope.displayMode = 'list';
    		}
    		
    		
    		$scope.listProducts();
    	}]);
    </script>
</head>
<body ng-controller="defaultCtrl">
    <div class="panel panel-primary">
        <h3 class="panel-heading">Products</h3>
        <ng-include src="'data/tableView.html'" ng-show="displayMode == 'list'"></ng-include>
        <ng-include src="'data/editorView.html'" ng-show="displayMode == 'edit'"></ng-include>
    </div>
</body>
</html>








